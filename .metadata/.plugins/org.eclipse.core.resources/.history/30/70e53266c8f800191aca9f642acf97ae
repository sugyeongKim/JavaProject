package view;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;

import assets.DBConnectionMgr;

public class memberShow extends JPanel{
	 	private JTable table;   
	 	private JScrollPane scrollPane;  
	 	private JButton jBtnAddRow = null; 
	 	private JButton jBtnSaveRow = null;
	 	
	 	private String colNames[] = {"num","name","gender","age","tel","addr","mileage"};
	 	private DefaultTableModel model = new DefaultTableModel(colNames, 0);
	 	
		DBConnectionMgr pool = DBConnectionMgr.getInstance();
		Connection con = null;       //연결
	    PreparedStatement ps = null; //명령
	    ResultSet rs = null;         //결과
	    String sql = null;
	    
	   public memberShow() {
		   setLayout(null);        // 레이아웃 배치관리자 삭제
		   table = new JTable(model); 
		   table.addMouseListener(new JTableMouseListener());     
		   scrollPane = new JScrollPane(table);  
		   scrollPane.setSize(500, 200);
		   add(scrollPane);  
		   initialize(); 
		   select();

	   }
	   
	   private class JTableMouseListener implements MouseListener{    // 마우스로 눌려진값확인하기
           public void mouseClicked(java.awt.event.MouseEvent e) {    // 선택된 위치의 값을 출력
        	JTable jtable = (JTable)e.getSource();
        	int row = jtable.getSelectedRow();                // 선택된 테이블의 행값
        	int col = jtable.getSelectedColumn();         // 선택된 테이블의 열값
        	
        	System.out.println(model.getValueAt(row, col)); 
        	select();
           }// 선택된 위치의 값을 얻어내서 출력
        	@Override
        	public void mouseEntered(MouseEvent arg0) {
        	}
        	@Override
        	public void mouseExited(MouseEvent arg0) {
        		// TODO Auto-generated method stu
        	}
        	@Override
        	public void mousePressed(MouseEvent arg0) {

        	}
        	@Override
        	public void mouseReleased(MouseEvent arg0) {
        	}
 }

	   
	   public static void main(String[] args) {
		   memberShow panel = new memberShow();
		   JFrame win = new JFrame();
		   win.setTitle("회원 목록");
		   win.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		   win.add(panel);
		   win.setSize(520,400);
		   win.setVisible(true);

	}
	   private void select() {
		// TODO Auto-generated method stub
		 String query = "select * from member order by num asc;";    
		 
		 try {
			 con = pool.getConnection();
			 Statement st = con.createStatement();

		     ps = con.prepareStatement(sql);
		     rs = ps.executeQuery();
			 
		     while(rs.next()) {
		    	 model.addRow(new Object[] {rs.getString("num"),
		    		 rs.getString("name"),rs.getString("gender"),rs.getString("age"),
		    		 rs.getString("tel"),rs.getString("addr"),rs.getString("mileage")});
		     }
		} catch (Exception e) {
			// TODO: handle exception
		}finally {
			try {
				rs.close();
				ps.close();
				con.close();
			}catch (Exception e2) {
				// TODO: handle exception
			}
		}
	}
	private void initialize() {            // 액션이벤트와 버튼 컴포넌트 설
		        // 테이블 새로 한줄 추가하는 부분
		            jBtnAddRow = new JButton();
		            jBtnAddRow.addActionListener(new ActionListener() {   
		                public void actionPerformed(ActionEvent e) {
		                    System.out.println(e.getActionCommand());        // 선택된 버튼의 텍스트값 출력
		                    DefaultTableModel model2 = (DefaultTableModel)table.getModel();
		                    model2.addRow(new String[]{"","","","",""});  // 새테이블의 초기값
		                }
		            });
		            jBtnAddRow.setBounds(180,222,110,30);
		            jBtnAddRow.setText("조회");
		            add(jBtnAddRow);

		  
	
	
	}
}